<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal | ASET</title>
    <link href="styles.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="d-flex align-items-center gap-2 text-white text-decoration-none fs-4 fw-bold">
                    <span class="bg-white text-primary rounded px-2"><i class="bi bi-mortarboard-fill"></i></span>
                    <span style="font-family: var(--font-display);">ASET</span>
                </a>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-link-custom active" onclick="showSection('dashboard')">
                    <i class="bi bi-grid-fill"></i> Dashboard
                </a>
                <a href="#" class="nav-link-custom" onclick="showSection('new-case')">
                    <i class="bi bi-plus-circle-fill"></i> New Request
                </a>
                <a href="#" class="nav-link-custom" onclick="showSection('history')">
                    <i class="bi bi-clock-history"></i> Case History
                </a>
                <a href="#" class="nav-link-custom" onclick="showSection('profile')">
                    <i class="bi bi-person-circle"></i> Profile
                </a>
            </nav>

            <div class="p-3 border-top border-white border-opacity-10">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar rounded-circle bg-white text-primary fw-bold d-flex align-items-center justify-content-center"
                        style="width: 40px; height: 40px;">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    <div class="overflow-hidden">
                        <div class="fw-bold text-truncate small text-white" id="navName">Student</div>
                        <div class="text-white-50 small text-truncate" style="font-size: 0.75rem;">student@aset.edu.ng
                        </div>
                    </div>
                    <button class="btn btn-link text-white ms-auto" onclick="ASET.logout()"><i
                            class="bi bi-box-arrow-right"></i></button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <button class="btn btn-light d-lg-none mb-3"
                onclick="document.getElementById('sidebar').classList.toggle('show')">
                <i class="bi bi-list"></i> Menu
            </button>

            <!-- Dashboard View -->
            <div id="view-dashboard" class="content-view">
                <header class="mb-5">
                    <h2 class="fw-bold" id="welcomeMsg">Welcome, Student!</h2>
                    <p class="text-secondary">Here is an overview of your academic cases.</p>
                </header>

                <div class="row g-4">
                    <div class="col-lg-8">
                        <!-- Active Case Card -->
                        <div class="card-clean p-4 mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="fw-bold mb-0 text-primary"><i class="bi bi-mortarboard me-2"></i>My Cases
                                </h5>
                                <span class="badge bg-light text-secondary border">ID: <span
                                        id="dashCaseId">--</span></span>
                            </div>

                            <div class="p-4 bg-light rounded-3 border mb-4">
                                <div class="d-flex align-items-center justify-content-between mb-3">
                                    <h4 class="fw-bold mb-0" id="dashCaseType">No Active Case</h4>
                                    <span class="badge bg-success-subtle text-success fs-6 px-3"
                                        id="dashStatus">--</span>
                                </div>

                                <div class="d-flex gap-4 text-secondary small">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="bi bi-person-badge"></i>
                                        Case Officer: <span class="fw-bold text-dark" id="dashOfficer">Unassigned</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="bi bi-calendar"></i>
                                        Last Update: <span id="dashDate">--</span>
                                    </div>
                                </div>
                            </div>

                            <h6 class="fw-bold text-secondary mb-3 text-uppercase small ls-1">Case Progress</h6>
                            <!-- Horizontal Stepper from Image -->
                            <div class="h-stepper" id="dashStepper">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Submit New CTA -->
                        <div
                            class="bg-primary text-white rounded-4 p-4 d-flex align-items-center justify-content-between shadow-lg">
                            <div>
                                <h4 class="fw-bold mb-1">Need something else?</h4>
                                <p class="mb-0 text-white-50">Start a new request for transfer, withdrawal, or
                                    probation.</p>
                            </div>
                            <button class="btn btn-light text-primary fw-bold px-4 py-2"
                                onclick="showSection('new-case')">
                                Submit New Request <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card-clean p-4 h-100">
                            <h5 class="fw-bold mb-4">Notifications</h5>
                            <div class="text-center text-secondary py-5">
                                <i class="bi bi-bell-slash fs-1 mb-2"></i>
                                <p>No new notifications</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Case Grid (Grid from Image) -->
            <div id="view-new-case" class="content-view d-none">
                <header class="mb-4">
                    <button class="btn btn-sm btn-light border mb-2" onclick="showSection('dashboard')"><i
                            class="bi bi-arrow-left"></i> Back</button>
                    <h2 class="fw-bold">New Case Request</h2>
                    <p class="text-secondary">Select the type of assistance you need.</p>
                </header>

                <div class="row g-4">
                    <!-- Card 1 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('Change of Programme')">
                            <div class="d-flex  gap-3">
                                <div class="rounded-3 bg-primary-subtle text-primary p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-arrow-left-right"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">Change of Programme</h5>
                                    <p class="text-secondary small mb-0">Start the intra-university transfer to another
                                        department.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('Probation Recovery')">
                            <div class="d-flex gap-3">
                                <div class="rounded-3 bg-warning-subtle text-warning p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-life-preserver"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">On Probation</h5>
                                    <p class="text-secondary small mb-0">Get help with academic recovery and counseling
                                        plans.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 3 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('University Transfer')">
                            <div class="d-flex gap-3">
                                <div class="rounded-3 bg-success-subtle text-success p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-buildings"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">Transfer to Another University</h5>
                                    <p class="text-secondary small mb-0">Process transcripts and clearance for external
                                        transfer.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 4 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('Withdrawal')">
                            <div class="d-flex gap-3">
                                <div class="rounded-3 bg-danger-subtle text-danger p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-x-circle"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">Withdrawal Process</h5>
                                    <p class="text-secondary small mb-0">Formal voluntary withdrawal from the
                                        university.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 5 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('Deferment')">
                            <div class="d-flex gap-3">
                                <div class="rounded-3 bg-info-subtle text-info p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-pause-circle"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">Deferment / Suspension</h5>
                                    <p class="text-secondary small mb-0">Pause your studies for a semester or session.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 6 -->
                    <div class="col-md-6 col-xl-4">
                        <div class="request-type-card" onclick="selectCaseType('Matric Number')">
                            <div class="d-flex gap-3">
                                <div class="rounded-3 bg-secondary-subtle text-secondary p-3 fs-3 d-flex align-items-center justify-content-center"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-123"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-1">Matric Number Generation</h5>
                                    <p class="text-secondary small mb-0">Request a standardized registration number.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doc Upload View (Step 2) -->
            <div id="view-upload" class="content-view d-none">
                <header class="mb-4">
                    <button class="btn btn-sm btn-light border mb-2" onclick="showSection('new-case')"><i
                            class="bi bi-arrow-left"></i> Back</button>
                    <h2 class="fw-bold">Upload Documents</h2>
                    <p class="text-secondary">Please provide evidence for your <strong class="text-primary"
                            id="uploadCaseType">request</strong>.</p>
                </header>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card-clean p-5 text-center mb-4">
                            <i class="bi bi-cloud-arrow-up fs-1 text-primary mb-3"></i>
                            <h5>Drag & Drop Files Here</h5>
                            <p class="text-muted small">Result Slips, Letters, ID Cards (PDF/JPG)</p>
                            <button class="btn btn-outline-primary btn-sm mt-2">Browse Files</button>
                        </div>
                        <button class="btn btn-primary w-100 py-3" onclick="goToPayment()">Continue to Payment <i
                                class="bi bi-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- Payment Page (Dedicated View as per Image) -->
            <div id="view-payment" class="content-view d-none">
                <header class="mb-4 text-center">
                    <h2 class="fw-bold">Payment Page</h2>
                </header>

                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="card-clean p-4">
                            <h5 class="fw-bold border-bottom pb-3 mb-4">Review & Pay</h5>

                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <span class="text-secondary">Case Summary: <strong class="text-dark"
                                        id="paySummary">Change of Programme</strong></span>
                                <span class="fs-4 fw-bold text-dark">₦5,000</span>
                            </div>

                            <label class="form-label small fw-bold text-secondary text-uppercase mb-2">Payment
                                Method</label>
                            <div class="d-flex gap-2 mb-4">
                                <button class="btn btn-primary flex-fill"><i
                                        class="bi bi-credit-card-fill me-2"></i>Credit / Debit Card</button>
                                <button class="btn btn-light border flex-fill text-muted"><i
                                        class="bi bi-bank me-2"></i>Bank Transfer</button>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small text-muted">Card Number</label>
                                <input type="text" class="form-control" placeholder="0000 0000 0000 0000">
                            </div>
                            <div class="row g-2 mb-4">
                                <div class="col-6">
                                    <label class="form-label small text-muted">Expiry</label>
                                    <input type="text" class="form-control" placeholder="MM/YY">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small text-muted">CVV</label>
                                    <input type="text" class="form-control" placeholder="123">
                                </div>
                            </div>

                            <button class="btn btn-primary w-100 py-3 fw-bold" onclick="processPayment()">
                                Pay ₦5,000
                            </button>
                            <p class="text-center mt-3 text-muted small">Note: Payment does not guarantee approval by
                                the university.</p>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script>
        ASET.checkAuth('student');
        const currentUser = ASET.getCurrentUser();
        document.getElementById('navName').innerText = currentUser.name;
        document.getElementById('welcomeMsg').innerText = `Welcome, ${currentUser.name.split(' ')[0]}!`;

        function showSection(id) {
            document.querySelectorAll('.content-view').forEach(el => el.classList.add('d-none'));
            document.getElementById('view-' + id).classList.remove('d-none');
            // update nav active state logic here if needed
        }

        let currentSelection = null;

        function selectCaseType(type) {
            currentSelection = type;
            document.getElementById('uploadCaseType').innerText = type;
            showSection('upload');
        }

        function goToPayment() {
            document.getElementById('paySummary').innerText = currentSelection;
            showSection('payment');
        }

        function processPayment() {
            // Create Case
            const newCase = ASET.createCase({
                studentId: currentUser.id,
                studentName: currentUser.name,
                type: currentSelection,
                paymentStatus: 'paid'
            });

            alert('Payment Successful!');
            renderDashboard();
            showSection('dashboard');
        }

        function renderDashboard() {
            const cases = ASET.getCases().filter(c => c.studentId === currentUser.id);
            const activeCase = cases[cases.length - 1];

            if (activeCase) {
                document.getElementById('dashCaseId').innerText = activeCase.id;
                document.getElementById('dashCaseType').innerText = activeCase.type;
                document.getElementById('dashStatus').innerText = activeCase.status;
                if (activeCase.officer) document.getElementById('dashOfficer').innerText = activeCase.officer;
                document.getElementById('dashDate').innerText = ASET.formatDate(activeCase.timeline[activeCase.timeline.length - 1].date).split(',')[0];

                // Render Horizontal Stepper
                const stages = ['Submitted', 'Under Review', 'Department Review', 'Faculty Review', 'Registry Review', 'Completed'];
                const currentStageIdx = stages.findIndex(s => s === activeCase.status) !== -1 ? stages.findIndex(s => s === activeCase.status) : 1;

                const stepper = document.getElementById('dashStepper');
                stepper.innerHTML = '';

                // For spacing in horizontal stepper, limit to 4-5 major steps logic or map exact stages
                const visualStages = ['Submitted', 'Under Review', 'Faculty Stage', 'Registry Stage', 'Final Decision'];
                // simple map logic for demo
                let visualIdx = 0;
                if (activeCase.status.includes('Department')) visualIdx = 2; // map to faculty stage visual area
                else if (activeCase.status.includes('Faculty')) visualIdx = 2;
                else if (activeCase.status.includes('Registry')) visualIdx = 3;
                else if (activeCase.status === 'Completed' || activeCase.status === 'Approved') visualIdx = 4;
                else if (activeCase.status === 'Submitted') visualIdx = 0;
                else visualIdx = 1;

                visualStages.forEach((stage, idx) => {
                    const isCompleted = idx <= visualIdx;
                    const isActive = idx === visualIdx;

                    const div = document.createElement('div');
                    div.className = `h-step ${isActive ? 'active' : ''} ${idx < visualIdx ? 'completed' : ''}`;
                    div.innerHTML = `
                        <div class="h-step-circle"></div>
                        <div class="h-step-label">${stage}</div>
                     `;
                    stepper.appendChild(div);
                });
            }
        }

        renderDashboard();
        showSection('dashboard');
    </script>
</body>

</html>