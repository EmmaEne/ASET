<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Admin | ASET</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="../student/styles/student-dashboard.css" rel="stylesheet">
    <link href="../shared/styles/ui-states.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="desktop-sidebar d-none d-lg-flex border-end border-dark bg-dark text-white">
            <div class="sidebar-brand text-white">
                <div class="brand-icon bg-white text-dark"><i class="bi bi-shield-fill-check"></i></div>
                <span class="brand-name text-white">Super Admin</span>
            </div>
            <nav class="sidebar-nav">
                <a href="javascript:void(0)" class="nav-item active text-white-50"
                    onclick="switchView('dashboard', this)">
                    <i class="bi bi-speedometer2"></i> <span>Overview</span>
                </a>
                <a href="javascript:void(0)" class="nav-item text-white-50" onclick="switchView('audit', this)">
                    <i class="bi bi-list-check"></i> <span>Audit Logs</span>
                </a>
                <a href="javascript:void(0)" class="nav-item text-white-50" onclick="switchView('access', this)">
                    <i class="bi bi-person-lock"></i> <span>Access Control</span>
                </a>
                <a href="javascript:void(0)" class="nav-item text-white-50" onclick="switchView('database', this)">
                    <i class="bi bi-database"></i> <span>Database</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-user-card" onclick="handleLogout()">
                    <img src="https://ui-avatars.com/api/?name=Super+Admin&background=334155&color=fff&bold=true"
                        class="avatar-sm">
                    <div class="user-details ms-2">
                        <div class="name fw-bold small text-dark">Root User</div>
                        <div class="role text-dark" style="font-size: 0.7rem;">System Owner</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Override Sidebar Styles for Dark Mode Sidebar -->
        <style>
            .desktop-sidebar.bg-dark .nav-item.active {
                color: white !important;
                background: rgba(255, 255, 255, 0.1);
            }

            .desktop-sidebar.bg-dark .nav-item:hover {
                color: white !important;
            }
        </style>

        <div class="app-container">
            <header class="top-bar">
                <div class="user-welcome">
                    <div
                        class="avatar-circle d-lg-none bg-dark text-white d-flex align-items-center justify-content-center">
                        <i class="bi bi-shield-shaded"></i>
                    </div>
                    <div class="welcome-text">
                        <span class="greeting">System Control</span>
                        <span class="status-indicator">‚óè Secure Session</span>
                    </div>
                </div>
                <div class="d-flex gap-3 align-items-center">
                    <button class="btn-icon d-none d-lg-flex" onclick="handleLogout()">
                        <i class="bi bi-power text-danger"></i>
                    </button>
                </div>
            </header>

            <main class="main-content">

                <!-- DASHBOARD VIEW -->
                <div id="view-dashboard" class="app-view active container-fluid">
                    <!-- Dashboard Skeleton -->
                    <div class="skeleton-wrapper" id="dashboardSkeleton">
                        <div class="row g-3 mb-4 mt-2">
                            <div class="col-6 col-md-3">
                                <div class="skeleton skeleton-stat-card" style="height: 100px; background: #334155;">
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="skeleton skeleton-stat-card" style="height: 100px;"></div>
                            </div>
                        </div>
                        <div class="skeleton-side-card p-4">
                            <div class="skeleton skeleton-text w-50 mb-4"></div>
                            <div class="skeleton skeleton-progress mb-4"></div>
                            <div class="skeleton skeleton-text w-50 mb-2"></div>
                            <div class="skeleton skeleton-progress"></div>
                        </div>
                    </div>

                    <!-- Dashboard Actual Content -->
                    <div id="dashboardContent" style="display: none;" class="content-loaded">
                        <div class="row g-3 mb-4 mt-2">
                            <div class="col-6 col-md-3">
                                <div class="minimal-card mb-0 py-4 bg-dark text-white border-0 text-center">
                                    <h2 class="fw-bold mb-0">1,204</h2>
                                    <small class="text-white-50 fw-bold">Total Users</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="minimal-card mb-0 py-4 border-0 text-center">
                                    <h2 class="fw-bold mb-0 text-primary">843</h2>
                                    <small class="text-primary fw-bold">Active Cases</small>
                                </div>
                            </div>
                        </div>

                        <div class="section-title mt-0">System Health</div>
                        <div class="bg-white p-4 rounded-4 border mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="fw-bold small">Server Load</span>
                                <span class="text-success small fw-bold">Healthy (12%)</span>
                            </div>
                            <div class="progress mb-4" style="height: 6px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 12%"></div>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="fw-bold small">Storage Usage</span>
                                <span class="text-warning small fw-bold">Warning (78%)</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 78%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AUDIT LOGS -->
                <div id="view-audit" class="app-view container-fluid">
                    <!-- Audit Skeleton -->
                    <div class="skeleton-wrapper" id="auditSkeleton">
                        <div class="view-header">
                            <div class="skeleton skeleton-title"></div>
                        </div>
                        <div class="skeleton-table">
                            <div class="skeleton-table-header">
                                <div class="skeleton skeleton-text" style="flex: 1;"></div>
                                <div class="skeleton skeleton-text" style="flex: 1;"></div>
                                <div class="skeleton skeleton-text" style="flex: 1;"></div>
                                <div class="skeleton skeleton-text" style="flex: 1;"></div>
                            </div>
                            <div class="skeleton-table-row">
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                            </div>
                            <div class="skeleton-table-row">
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                                <div class="skeleton" style="flex: 1;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Actual Content -->
                    <div id="auditContent" style="display: none;" class="content-loaded">
                        <div class="view-header">
                            <h2>Audit Logs</h2>
                        </div>
                        <div class="bg-white rounded-4 border overflow-hidden p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0 align-middle">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="ps-4">Timestamp</th>
                                            <th>User</th>
                                            <th>Action</th>
                                            <th>Target</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="ps-4 text-muted small">Jan 30, 10:45 AM</td>
                                            <td class="fw-bold small">Admin</td>
                                            <td><span class="badge bg-light text-dark border">Updated Status</span></td>
                                            <td class="small">Case #00847</td>
                                        </tr>
                                        <tr>
                                            <td class="ps-4 text-muted small">Jan 30, 10:42 AM</td>
                                            <td class="fw-bold small">Adebayo O.</td>
                                            <td><span class="badge bg-light text-dark border">Login</span></td>
                                            <td class="small">System</td>
                                        </tr>
                                        <tr>
                                            <td class="ps-4 text-muted small">Jan 30, 09:15 AM</td>
                                            <td class="fw-bold small">System</td>
                                            <td><span
                                                    class="badge bg-danger-subtle text-danger border border-danger-subtle">Failed
                                                    Login</span></td>
                                            <td class="small">IP: 192.168.1.1</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <!-- ACCESS CONTROL -->
    <div id="view-access" class="app-view container-fluid">
        <div class="view-header">
            <h2>Access Control</h2>
        </div>

        <div class="card mb-3 border-0 shadow-sm">
            <div class="card-header bg-white fw-bold py-3">Student Permissions</div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Can view own cases</span>
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" checked
                            disabled></div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Can delete uploaded docs (within 24h)</span>
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" checked></div>
                </div>
            </div>
        </div>

        <div class="card mb-3 border-0 shadow-sm">
            <div class="card-header bg-white fw-bold py-3">Admin Permissions</div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Can overwrite system status</span>
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" checked></div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Can delete user accounts</span>
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox">
                    </div>
                </div>
            </div>
        </div>

        <button class="btn btn-primary fw-bold" onclick="saveAccessSettings(this)">Save Changes</button>
    </div>

    <!-- DATABASE -->
    <div id="view-database" class="app-view container-fluid">
        <div class="view-header">
            <h2>Database Viewer</h2>
        </div>
        <ul class="nav nav-pills mb-3 bg-white p-2 rounded-3 border w-auto d-inline-flex" id="db-tabs">
            <li class="nav-item"><button class="nav-link active rounded-pill small fw-bold"
                    onclick="renderDB('users')">Users</button></li>
            <li class="nav-item"><button class="nav-link rounded-pill small fw-bold"
                    onclick="renderDB('cases')">Cases</button></li>
            <li class="nav-item"><button class="nav-link rounded-pill small fw-bold"
                    onclick="renderDB('activity')">Activity</button></li>
        </ul>

        <div class="bg-dark rounded-4 p-4 text-white font-monospace text-wrap"
            style="min-height: 300px; font-size: 0.8rem;">
            <pre id="jsonOutput" class="text-white mb-0">Select a collection...</pre>
        </div>
    </div>

    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav d-lg-none bg-dark border-top border-secondary">
        <a href="javascript:void(0)" class="nav-btn active text-white" onclick="switchView('dashboard', this)">
            <i class="bi bi-speedometer2"></i> <span>Home</span>
        </a>
        <a href="javascript:void(0)" class="nav-btn text-white-50" onclick="switchView('audit', this)">
            <i class="bi bi-list-check"></i> <span>Audit</span>
        </a>
        <a href="javascript:void(0)" class="nav-btn text-white-50" onclick="switchView('access', this)">
            <i class="bi bi-shield-lock"></i> <span>Auth</span>
        </a>
        <a href="javascript:void(0)" class="nav-btn text-white-50" onclick="switchView('database', this)">
            <i class="bi bi-database"></i> <span>DB</span>
        </a>
    </nav>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../shared/scripts/app.js"></script>
    <script src="../shared/scripts/ui-states.js"></script>
    <script>
        function saveAccessSettings(btn) {
            const original = btn.innerText;
            btn.innerText = 'Saving...';
            btn.disabled = true;
            setTimeout(() => {
                btn.innerText = 'Saved!';
                btn.classList.replace('btn-primary', 'btn-success');

                // Show success toast
                UIStates.showToast('Access settings updated successfully!', 'success');

                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = original;
                    btn.classList.replace('btn-success', 'btn-primary');
                }, 1000);
            }, 800);
        }

        function renderDB(collection) {
            const prefix = 'aset_'; // from app.js settings
            let data = [];

            if (collection === 'users') data = ASET.defaults.users; // Fallback / actual read
            try {
                const stored = localStorage.getItem(prefix + collection);
                if (stored) data = JSON.parse(stored);
                else if (collection === 'users') data = ASET.defaults.users; // Mock for defaults if not in LS yet
                else if (collection === 'cases') data = ASET.defaults.cases;
                else if (collection === 'activity') data = ASET.defaults.activity;
            } catch (e) { }

            document.getElementById('jsonOutput').innerText = JSON.stringify(data, null, 2);

            // Update active tab styling
            document.querySelectorAll('#db-tabs .nav-link').forEach(l => l.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Init
        renderDB('users');
    </script>
</body>

</html>